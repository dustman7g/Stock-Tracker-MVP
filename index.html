<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>48-Hour Stock & Dividend Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 10px;
    }
    h1, h2 {
      text-align: center;
    }
    .group {
      margin-bottom: 50px;
    }
    .stock-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }
    .stock-card {
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fdfdfd;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .stock-card h3 {
      margin: 0 0 10px;
      font-size: 18px;
    }
    .stock-card p {
      margin: 5px 0;
      font-size: 14px;
    }
    canvas {
      width: 100% !important;
      height: 180px !important;
    }
  </style>
</head>
<body>

<h1>48-Hour Stock & Dividend Tracker</h1>

<div class="group">
  <h2>Stocks</h2>
  <div id="stocks" class="stock-grid">
    <p>Loading stock charts…</p>
  </div>
</div>

<div class="group">
  <h2>Dividends / REIT Income</h2>
  <div id="dividends" class="stock-grid">
    <p>Loading dividend charts…</p>
  </div>
</div>

<script>
const groups = {
  "stocks": ["AMZN", "PLTR", "SOFI", "NVDA"],
  "dividends": ["O", "SCHD"]
};

const CORS_PROXY = "https://corsproxy.io/?";

async function getStockData(ticker) {
  const url = `${CORS_PROXY}https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=30m&range=2d`;
  const res = await fetch(url);
  const data = await res.json();

  const result = data.chart.result[0];
  const timestamps = result.timestamp;
  const prices = result.indicators.quote[0].close;

  const readableTimes = timestamps.map(t => new Date(t * 1000).toLocaleString());
  return { ticker, timestamps: readableTimes, prices };
}

function createChart(canvasId, label, labels, data) {
  new Chart(document.getElementById(canvasId), {
    type: "line",
    data: {
      labels: labels,
      datasets: [{
        label: `${label} Price`,
        data: data,
        borderWidth: 2,
        fill: false,
        borderColor: "#007bff"
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { x: { display: false } }
    }
  });
}

async function buildGroup(containerId, tickers) {
  const container = document.getElementById(containerId);
  container.innerHTML = ""; // Clear placeholder

  for (let t of tickers) {
    const stock = await getStockData(t);

    const latest = stock.prices[stock.prices.length - 1];
    const earlier = stock.prices[0];
    const pctChange = (((latest - earlier) / earlier) * 100).toFixed(2);
    const rating = pctChange > 0 ? "BUY" : "HOLD";

    const div = document.createElement("div");
    div.className = "stock-card";
    div.innerHTML = `
      <h3>${t}</h3>
      <p><strong>Latest:</strong> $${latest.toFixed(2)}</p>
      <p><strong>48h Change:</strong> ${pctChange}%</p>
      <p><strong>Signal:</strong> ${rating}</p>
      <canvas id="${t}-chart"></canvas>
    `;
    container.appendChild(div);
    createChart(`${t}-chart`, t, stock.timestamps, stock.prices);
  }
}

async function buildPage() {
  await buildGroup("stocks", groups.stocks);
  await buildGroup("dividends", groups.dividends);
}

window.onload = buildPage;
</script>

</body>
</html>
